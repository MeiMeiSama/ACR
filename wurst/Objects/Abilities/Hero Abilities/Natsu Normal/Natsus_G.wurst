package Natsus_G

import ClosureTimers
import ACR_Effects
timer natsusDoT_Timer
init

function applyDoTCond () returns boolean
    if GetEventDamageSource().hasAbility('A01K') or GetEventDamageSource().hasAbility('A054')
        return true
    return false

public function saboG ()
    CreateTrigger()
    ..registerAnyUnitEvent(EVENT_PLAYER_UNIT_DAMAGED)
    ..addCondition(Condition(function applyDoTCond))
    ..addAction() ->
        let victim = GetTriggerUnit()
        let maxHP = victim.getMaxHP()
        let dmg = maxHP * 0.002
        natsusDoT_Timer.destr()
        natsusDoT_Timer = CreateTimer()..doPeriodicallyTimed(0.1, 2.5) (CallbackCounted cb) ->
            if victim.isAlive()
                if victim.getHP() > dmg
                    victim.setHP(victim.getHP() - dmg)
                    flashEffect(DOT_EFFECT, victim, "origin")
                else 
                    victim.setHP(1)

            else
                destroy cb